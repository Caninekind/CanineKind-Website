<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Training Sessions - CanineKind Client Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #D1E5F4 0%, #e8f4f8 100%);
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Portal Header */
        .portal-header {
            background: linear-gradient(135deg, #799972 0%, #8aaa83 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .portal-logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .portal-logo img {
            height: 50px;
            width: auto;
        }

        .portal-logo h1 {
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .portal-nav {
            display: flex;
            gap: 1.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .portal-nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
            padding: 0.5rem 1rem;
            border-radius: 5px;
        }

        .portal-nav a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .portal-nav a.active {
            background: rgba(255, 255, 255, 0.3);
            font-weight: 600;
        }

        .sign-out-link {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.85rem;
            padding: 0.4rem 0.8rem;
        }

        .sign-out-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        /* Page Container */
        .page-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .page-header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            text-align: center;
        }

        .page-header h2 {
            color: #799972;
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .page-header p {
            color: #666;
            font-size: 1.1em;
        }

        /* Section Headers */
        .section-header {
            background: white;
            padding: 20px 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-header h3 {
            color: #799972;
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .section-header p {
            color: #666;
            font-size: 0.95em;
        }

        /* Sessions Grid */
        .sessions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .session-card {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #4a90e2;
            cursor: pointer;
        }

        .session-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .session-card.upcoming {
            border-left-color: #4a90e2;
        }

        .session-card.completed {
            border-left-color: #51cf66;
            opacity: 0.85;
        }

        .session-icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .session-date {
            font-size: 1.3em;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .session-time {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 12px;
        }

        .session-type {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .session-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 0.9em;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #999;
            margin-bottom: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #799972 0%, #8aaa83 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(121, 153, 114, 0.3);
        }


        /* Mobile Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .portal-nav {
                gap: 0.5rem;
                font-size: 0.9rem;
                justify-content: center;
            }

            .portal-nav a {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }

            .sign-out-link {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
                opacity: 0.6;
                margin-left: 1rem;
            }

            .page-header h2 {
                font-size: 1.8em;
            }

            .sessions-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Portal Header -->
    <header class="portal-header">
        <div class="header-content">
            <div class="portal-logo">
                <img src="https://i.imgur.com/OXiQWa3.jpeg" alt="CanineKind Logo">
                <h1>Client Portal</h1>
            </div>
            <nav class="portal-nav">
                <a href="portal-dashboard.html">Dashboard</a>
                <a href="portal-sessions.html" class="active">Sessions</a>
                <a href="portal-forms.html">Forms & Documents</a>
                <a href="portal-schedule.html">Weekly Schedule</a>
                <a href="portal-goals.html">Goals</a>
                <a href="#" class="sign-out-link" onclick="signOut(); return false;">Sign Out</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="page-container">
        <!-- Page Header -->
        <div class="page-header">
            <h2>Training Sessions</h2>
            <p>View your upcoming and past training sessions</p>
        </div>

        <!-- Upcoming Sessions Section -->
        <div class="section-header">
            <h3>Upcoming Sessions</h3>
            <p>Your scheduled training appointments</p>
        </div>

        <div class="sessions-grid" id="upcomingSessions">
            <!-- Upcoming sessions will be loaded here -->
        </div>

        <!-- Past Sessions Section -->
        <div class="section-header">
            <h3>ðŸ“‹ Past Sessions</h3>
            <p>Review previous training sessions and notes</p>
        </div>

        <div class="sessions-grid" id="pastSessions">
            <!-- Past sessions will be loaded here -->
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- Firebase Config -->
    <script src="firebase-config.js"></script>

    <script>
        let currentUser = null;

        // Initialize Firebase and check authentication
        document.addEventListener('DOMContentLoaded', async () => {
            const initialized = initializeFirebase();

            if (!initialized) {
                alert('Failed to initialize Firebase');
                window.location.href = 'portal-login.html';
                return;
            }

            // Check authentication
            auth.onAuthStateChanged(async (user) => {
                if (!user) {
                    window.location.href = 'portal-login.html';
                } else {
                    currentUser = user;
                    await loadSessions();
                }
            });
        });

        // Load sessions for the user
        async function loadSessions() {
            const upcomingGrid = document.getElementById('upcomingSessions');
            const pastGrid = document.getElementById('pastSessions');

            try {
                // TODO: Fetch sessions from Firestore
                // For now, we'll use placeholder data structure
                // Real implementation will query Firestore for sessions

                // Firestore structure will be:
                // sessions/{sessionId}
                //   - clientEmail: string
                //   - date: timestamp
                //   - type: string
                //   - status: 'scheduled' | 'completed' | 'cancelled'
                //   - duration: number (minutes)
                //   - notes: object { pre, during, post }
                //   - homework: array

                const sessions = await fetchUserSessions();

                if (sessions.length === 0) {
                    upcomingGrid.innerHTML = '';
                    pastGrid.innerHTML = '';
                    return;
                }

                // Separate upcoming and past sessions
                const now = new Date();
                const upcoming = sessions.filter(s => s.date > now);
                const past = sessions.filter(s => s.date <= now);

                // Render upcoming sessions
                if (upcoming.length > 0) {
                    upcomingGrid.innerHTML = upcoming.map(session => renderSessionCard(session, 'upcoming')).join('');
                } else {
                    upcomingGrid.innerHTML = '<div class="empty-state"><p style="color: #999;">No upcoming sessions</p></div>';
                }

                // Render past sessions
                if (past.length > 0) {
                    pastGrid.innerHTML = past.map(session => renderSessionCard(session, 'completed')).join('');
                } else {
                    pastGrid.innerHTML = '<div class="empty-state"><p style="color: #999;">No past sessions</p></div>';
                }

            } catch (error) {
                console.error('Error loading sessions:', error);
                upcomingGrid.innerHTML = '<div class="empty-state"><p style="color: #dc3545;">Error loading sessions. Please refresh.</p></div>';
            }
        }

        // Fetch user sessions from Firestore
        async function fetchUserSessions() {
            try {
                // Query top-level sessions collection filtered by clientId
                const sessionsRef = db.collection('sessions')
                    .where('clientId', '==', currentUser.uid)
                    .orderBy('sessionDate', 'desc');

                const snapshot = await sessionsRef.get();

                return snapshot.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data(),
                    date: doc.data().sessionDate.toDate()
                }));
            } catch (error) {
                console.error('Error fetching sessions:', error);
                return [];
            }
        }

        // Render a session card
        function renderSessionCard(session, status) {
            const dateStr = session.date.toLocaleDateString('en-US', {
                weekday: 'short',
                month: 'short',
                day: 'numeric'
            });
            const timeStr = session.date.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit'
            });

            const statusText = status === 'upcoming' ? 'Scheduled' : 'Completed';

            return `
                <div class="session-card ${status}" onclick="viewSession('${session.id}')">
                    <div class="session-status-badge">${statusText}</div>
                    <div class="session-date">${dateStr}</div>
                    <div class="session-time">${timeStr}</div>
                    <div class="session-type">${session.type || 'Training Session'}</div>
                    <div class="session-status">
                        <span>${statusText}</span>
                        ${session.duration ? `â€¢ ${session.duration} minutes` : ''}
                    </div>
                </div>
            `;
        }

        // View session details (will be implemented later)
        function viewSession(sessionId) {
            // TODO: Navigate to session detail page or open modal
            console.log('View session:', sessionId);
            alert('Session details view coming soon!');

            /* Future implementation:
            window.location.href = `portal-session-detail.html?id=${sessionId}`;
            */
        }

        // Sign out function
        async function signOut() {
            try {
                await firebase.auth().signOut();
                window.location.href = 'portal-login.html';
            } catch (error) {
                console.error('Error signing out:', error);
            }
        }

        /*
        ==============================================
        ADMIN VERSION NOTES (for future implementation)
        ==============================================

        Admin-specific features to add:
        1. Button to "Create New Session"
        2. Ability to edit session notes
        3. View all clients' sessions (not filtered)
        4. Add session homework/tasks
        5. Upload photos/videos to sessions
        6. Mark sessions as completed/cancelled

        Suggested admin page: portal-sessions-admin.html
        - Same layout but with admin controls
        - Create/Edit/Delete sessions
        - Bulk actions
        */
    </script>
</body>
</html>
